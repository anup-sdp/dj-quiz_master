{% extends "base.html" %}
{% block title %}Set New Password - QuizMaster{% endblock %}
{% block content %}
<div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-8">
    <h2 class="text-2xl font-bold mb-6">Set New Password</h2>
    
    {% if validlink %}
        <p class="text-gray-600 mb-6">Please enter your new password twice so we can verify you typed it in correctly.</p>
        
        <form method="post" onsubmit="return validatePasswords()">
            {% csrf_token %}
            <div class="mb-4">
                <label class="block text-gray-700 mb-2" for="{{ form.new_password1.id_for_label }}">New Password</label>
                {{ form.new_password1 }}
                {% if form.new_password1.errors %}
                    <div class="text-red-500 text-sm mt-1">{{ form.new_password1.errors }}</div>
                {% endif %}
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-700 mb-2" for="{{ form.new_password2.id_for_label }}">Confirm Password</label>
                {{ form.new_password2 }}
                {% if form.new_password2.errors %}
                    <div class="text-red-500 text-sm mt-1">{{ form.new_password2.errors }}</div>
                {% endif %}
            </div>
            
            <div id="password-error" class="text-red-500 text-sm mb-4 hidden">
                Passwords do not match.
            </div>
            
            <div class="flex justify-end">
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Reset Password</button>
            </div>
        </form>
    {% else %}
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
            <p>The password reset link is invalid or has expired.</p>
        </div>
        <p class="text-gray-600 mb-6">Please request a new password reset.</p>
        <div class="text-center">
            <a href="{% url 'password_reset' %}" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Request New Reset Link</a>
        </div>
    {% endif %}
</div>

<script>
    function validatePasswords() {
        const password1 = document.getElementById('id_new_password1').value;
        const password2 = document.getElementById('id_new_password2').value;
        const errorElement = document.getElementById('password-error');
        
        if (password1 !== password2) {
            errorElement.classList.remove('hidden');
            return false;
        } else {
            errorElement.classList.add('hidden');
            return true;
        }
    }
</script>
{% endblock %}